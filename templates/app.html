<!DOCTYPE html> 
<html> 
<head> 
  <title>Substance â€” Open Documents for the Web</title>
  
  <script>
    var seed = {{{{seed}}}};
    var config = {{{{config}}}};
    var session = {{{{session}}}};
    var scripts = {{{{scripts}}}};
  </script>
  
  <script type="text/x-ejs-template" name="edit_attributes">
    <dl class="document-attributes">
      <dt>Creator</dt>
      <dd><%= doc.get('creator').get('username') %></dd>
      
      <dt>Created On</dt>
      <dd><%= _.date(doc.get('created_at')) %></dd>
      
      <dt>Last modified</dt>
      <dd><%= _.prettyDate(new Date(doc.get('updated_at')).toJSON()) %></dd>
      
      <dt>Views</dt>
      <dd><%= doc.get('views') %></dd>
      
      <% attributes.each(function(attribute) { %>
        <dt><%= attribute.name %></dt>
        <dd id="property_<%= attribute.key %>" property="/<%= attribute.type._id.split('/')[2] %>/<%= attribute.key %>" key="<%= attribute.key %>" type="string" class="attribute-editor <%= attribute.unique ? "unique" : "non-unique"%>"></dd>
      <% }); %>
    </dl>
  </script>
  
  <script type="text/x-ejs-template" name="show_attributes">
    <dl class="document-attributes">
      <dt>Creator</dt>
      <dd><%= doc.get('creator').get('name') || doc.get('creator').get('username') %></dd>
      
      <dt>Created On</dt>
      <dd><%= _.date(doc.get('created_at')) %></dd>
      
      <dt>Last modified</dt>
      <dd><%= _.prettyDate(new Date(doc.get('updated_at')).toJSON()) %></dd>
      
      <dt>Views</dt>
      <dd><%= doc.get('views') %></dd>
      
      <% attributes.each(function(attribute) { %>
        <% if (doc.get(attribute.key).length > 0) { %>
          <dt><%= attribute.name %></dt>
          <dd>
            <div class="items">
              <% doc.get(attribute.key).each(function(v) { %>
                <div class="item"><%= v.get('name') %></div>
              <% }); %>
            </div>
          </dd>
        <% } %>
      <% }); %>
    </dl>
  </script>
  
  <script type="text/x-ejs-template" name="signup">
    <div id="signup" class="page-content">
      
      <form id="signup-form" class="auth-form">
        <h1>Start writing.</h1>
        <div id="registration_error_message"></div>
        <div>
          <label for="signup_user">Username:<span>http://substance.io/#USERNAME</span></label>
          <input type="text" id="signup_user" name="username"/>
          <div class="input-message" id="signup_user_message"></div>
        </div>
    
        <div>
          <label for="signup_name">Full Name:<span>Your real name</span></label>
          <input type="text" id="signup_name" name="name"/>
        </div>
    
        <div>
          <label for="signup_email">Email:<span>A valid email address</span></label>
          <input type="text" id="signup_email" name="email"/>
        </div>
    
        <div>
          <label for="signup_password">Password:<span>At least 3 characters</span></label>
          <input type="password" id="signup_password" name="password"/>
        </div>
        
        <div>
          <label for="">&nbsp;</label>
          <input type="submit" value="Create Account"/>
        </div>
      </form>
    </div>
  </script>
  
  <script type="text/x-ejs-template" name="startpage">
    <div id="startpage">
    
      <!--<div id="slider-wrapper">
        <div id="slider" class="nivoSlider">
          <img src="/images/startpage/intro1.png" alt="" />
          <a href="http://dev7studios.com"><img src="/images/startpage/intro2.png" alt="" title="This is an example of a caption" /></a>
          <img src="/images/startpage/intro3.png" alt="" />
          <img src="/images/startpage/intro4.png" alt="" title="#htmlcaption" />
        </div>
        <div id="htmlcaption" class="nivo-html-caption">
          <strong>This</strong> is an example of a <em>HTML</em> caption with <a href="/">a link</a>.
        </div>
      </div>-->
      
      <hr class="separator nomargin"/>
      <div class="intro">
        <div class="intro-text">
          Document authoring and publishing for the web. <br/><br/>
          <a href="#" class="watch-intro">Watch the Introduction Video</a>
        </div>
        
        <div class="video hidden">

        
        </div>
      </div>
      <hr class="separator nomargin"/>
      
      
      <div id="example_documents_header">Try some interactive documents</div>
      <div id="example_documents">
        <a href="http://substance.io/substance/getting-started"><div class="document">
          <div class="title">Getting Started</div>
          <div class="author">Substance Team</div>
        </div></a>
        <a href="http://substance.io/substance/substance-as-a-blog-engine"><div class="document">
          <div class="title">Use Substance as a blog engine</div>
          <div class="author">Substance Team</div>
        </div>
        <a href="http://substance.io/michael/data-js"><div class="document">
          <div class="title">Data.js</div>
          <div class="author">Michael Aufreiter</div>
        </div></a>
        <a href="http://substance.io/michael/offline-applications-with-datajs"><div class="document">
          <div class="title">Offline Applications with Data.js</div>
          <div class="author">Michael Aufreiter</div>
        </div></a>
      </div>
      
      <hr class="separator"/>
      
      <div id="plot">
        <div class="characteristics">
          <div class="characteristic">
            <h2>Semantic Editing</h2>
            <p>
            Unlike traditional word-processors, Substance focuses on content, by leaving the layout part to the system, not the user. Because of the absence of formatting utilities, it suggests structured, content-oriented writing.
            </p>
          </div>
          
          <div class="characteristic">
            <h2>Collaboration</h2>
            <p>
              Substance targets open collaboration. Readers can participate and comment on certain text passages. In future they'll even be able to submit patches, that can be applied by the owner.
            </p>
          </div>
          
          <div class="characteristic">
            <h2>Integration</h2>
            <p>
              Substance exposes documents as <a href="http://substance.io/documents/substance/substance">data</a>, ready to be compiled into arbitrary output formats
              (<a href="http://letterpress.substance.io/substance.html?url=http://substance.io/documents/substance/substance">HTML</a>, <a href="http://letterpress.substance.io/substance.pdf?url=http://substance.io/documents/substance/substance">PDF</a>, <a href="http://letterpress.substance.io/substance.epub?url=http://substance.io/documents/substance/substance">ePub</a>, ...) or integrated with other applications (like websites). 
            </p>
          </div>
        </div>
        
        <div class="description">
          <p>
            <b>Substance</b> is a fully web-based document authoring and publishing platform.</p><p>
            With Substance, <b>writers</b>, <b>journalists</b>, <b>scientists</b> and everyone else who's interested in publishing can
            use an open platform for writing and sharing articles.</p><p>Document authoring used to take place in word processors on the Desktop like <a href="http://office.microsoft.com/word/">MS Word</a> or <a href="http://openoffice.org/">Open Office</a>.
            We believe that today this can all be be done in the browser, in a simpler, more collaborative way.
          </p>
          <p>
            <br/>Substance is <a href="http://github.com/michael/substance">open source</a> and licensed under <a href="https://github.com/michael/substance/blob/master/LICENSE">GPLv3</a>.
          </p>
        </div>
      </div>
      
      <hr class="separator"/>
      
      <!-- Features -->
      <div id="features">
        <div class="feature write">
          <div class="feature-wrapper">
            <h1 class="feature-title">
              <div class="icon"/>
              Write
            </h1>
            <p class="feature-descr">
              <b>Write</b> and <b>annotate</b> documents right in the <b>browser</b>.
            </p> 
            <ul class="feature-properties">
              <li>
                <div>Collaborative Editing <small style="color: #bd0a0a;">NEW!</small></div>
                <div class="descr">Invite co-authors to your document</div>
              </li>
              <li>
                <div>Export <small style="color: #bd0a0a;">NEW!</small></div>
                <div class="descr">Export to PDF, ODT, ePub, etc.</div>
              </li>
              <li>
                <div>Publish</div>
                <div class="descr">Publish and instantly share your articles</div>
              </li>
              <li>
                <div>Images</div>
                <div class="descr">Embed images in your document</div>
              </li>
              <li>
                <div>User Comments</div>
                <div class="descr">Comment on content fragments</div>
              </li>
            </ul>
          </div>
        </div>
        
        <div class="feature browse">
          <div class="feature-wrapper">
            <h1 class="feature-title">
              <div class="icon"/>
              Browse
            </h1>
            <p class="feature-descr">
              <b>Find</b> and <b>read</b> relevant
              documents by using novel navigation techniques.
            </p> 
            <p class="feature-descr">
              Use the Browser Tab to search for a keyword or show <a href="/recent">recent documents</a>.
            </p>
            <ul class="feature-properties">
              <li>
                <div>Search by Keyword</div>
                <div class="descr">Find relevant documents based on keywords</div>
              </li>
              <li>
                <div>Faceted Browsing</div>
                <div class="descr">Filter matched documents using faceted navigation</div>
              </li>
            </ul>
          </div>
        </div>
        
        <div class="feature contribute">
          <div class="feature-wrapper">
            <h1 class="feature-title">
              <div class="icon"/>
              Contribute
            </h1>
            <p class="feature-descr">
              In order to <b>improve</b> the system
              and keep it <b>open</b> and <b>free</b>, we
              need your help!
            </p>
            <div>
              <form id="contribute_form" action="https://www.paypal.com/cgi-bin/webscr" method="post">
                <input type="hidden" name="cmd" value="_s-xclick">
                <input type="hidden" name="hosted_button_id" value="WAP9SGX5H29HS">
                <p>You can either <a href="https://flattr.com/thing/317181/Substance-Open-Documents-For-The-Web">flattr</a> us,
                or donate using <a href="/contribute" onclick="javascript: $('#contribute_form').submit(); return false;" id="contribute_button" class="">Paypal</a>.</p>
                <img alt="" border="0" src="https://www.paypal.com/de_DE/i/scr/pixel.gif" width="1" height="1">
              </form>
              
              <a class="FlattrButton" style="display:none;" href="http://substance.io"></a>
              <noscript><a href="http://flattr.com/thing/317181/Substance-Open-Documents-For-The-Web" target="_blank">
              <img src="http://api.flattr.com/button/flattr-badge-large.png" alt="Flattr this" title="Flattr this" border="0" /></a></noscript>
              <p>
                <br/>We have received <a href="http://substance.io/substance/contribute">$ 240.00</a> so far. Thank you for that!
              </p>
            </div>
          </div>
        </div>
      </div>
      <hr class="separator"/>
      
    </div>
  </script>
  
  <script type="text/x-ejs-template" name="header">
    <div class="title">
      <a href="/" class="toggle-startpage">Substance</a>
    </div>
    
    <% if (user) { %>
      <div id="login_state" class="logged-in">
        <div class="toggle notifications<%= notifications_active ? " active" : "" %>" title="Notifications">
          <div class="icon"></div>
          <div class="count"><span><%= count %></span></div>
        </div>
        <div class="toggle user-profile" title="User Profile">
          <div class="icon"><img src="/avatar/<%= user._id.split('/')[2] %>/25"/></div>
          <div class="lbl"><span><%= user.get('name') %></span></div>
        </div>
        <div class="toggle user-settings" title="User Settings">
          <div class="icon"></div>
        </div>
        <div class="toggle logout" title="Logout">
          <div class="icon"></div>
        </div>
        
        <div id="event_notifications" class="<%= notifications_active ? "active" : "" %>">
          <% notifications.each(function(n) { %>
            <a class="open-notification" href="<%= n.get('event').get('link') %>"><div class="notification<%= n.get('read') ? " read": " unread" %>">
              <img src="/avatar/<%= n.get('event').get('creator')._id.split('/')[2]%>/30">
              <div class="message"><%= n.get('event').get('message') %></div>
              <div class="timestamp"><%= _.prettyDate(n.get('event').get('created_at')) %></div>
            </div></a>
          <% }); %>
          <% if (notifications.length == 0) { %>
            <div class="notification">
              <div class="message">Currently no notifications</div>
            </div>
          <% } %>
        </div>
      </div>
    <% } else { %>
      <div id="login_state">
        <form id="login-form" class="auth-form">
          <input type="text" name="username" class="hint" id="login-user" value="Username">
          <input type="password" name="password" class="hint" id="login-password" value="Password">
          <input type="submit" value="Login"/>
        </form>
        <br class="clear"/>
        <div class="signup">
          <a href="/signup" class="toggle-signup">Create an Account</a>
          | <a href="/recover" class="">Forgot Password?</a>
        </div>
      </div>
    <% } %>
    <br class="clear"/>
  </script>


  <script type="text/x-ejs-template" name="user_settings">
    <div id="user_settings" class="page-content">
      
      <form id="user_settings_form">
        <h1>Account Settings</h1>
        <br/><h2>Public Profile</h2>
        <div>
          <label for="user_username">Username:<span>Cannot be changed</span></label>
          <%= user.get('username') %>
          <input type="hidden" id="user_username" name="user_username" value="<%= user.get('username') %>"/>
        </div>
        
        <div>
          <label for="user_name">Name:<span>Your full name</span></label>
          <input type="text" id="user_name" name="user_name" value="<%= user.get('name') %>"/>
        </div>
      
        <div>
          <label for="user_email">Email:<span>Publicly visible</span></label>
          <input type="text" id="user_email" name="user_email" value="<%= user.get('email') %>"/>
        </div>
                
        <div>
          <label for="user_website">Website:<span>http://your-website.com</span></label>
          <input type="text" id="user_website" name="user_website" value="<%= user.get('website') %>"/>
        </div>
        
        <div>
          <label for="user_company">Company:<span>Or organization</span></label>
          <input type="text" id="user_company" name="user_company" value="<%= user.get('company') %>"/>
        </div>
        
        <div>
          <label for="user_location">Location:<span>City, Country</span></label>
          <input type="text" id="user_location" name="user_location" value="<%= user.get('location') %>"/>
        </div>
        <br/><br/>
        <h2>Change password</h2>
      
        <div>
          <label for="user_password">Password:<span>Choose a new password or leave blank</span></label>
          <input type="password" id="user_password" name="user_password"/>
        </div>
        
        <div>
          <label for="user_password_confirmation">Password Confirmation:<span>Confirm new password</span></label>
          <input type="password" id="user_password_confirmation" name="user_password_confirmation"/>
        </div>
        
        <div>
          <label for="">&nbsp;</label>
          <input type="submit" id="document_name" value="Update Information"/>
        </div>
      </form>
    </div>
  </script>
  
  <script type="text/x-ejs-template" name="new_document">
    <div id="new_document" class="page-content">
      <h1>New Document</h1>
      <form id="create_document">        
        <div>
          <label for="new_document_name">Document Name:<span></span></label>
          <input type="text" id="new_document_name" name="new_document_name"/>
          <div class="input-message" id="new_document_name_message"></div>
        </div>
        
        <div>
          <label for="">&nbsp;</label>
          <input type="submit" id="document_name" value="Create Document"/>
        </div>
      </form>
    </div>
  </script>
  
  <script type="text/x-handlebars-template" name="document_wrapper">
    <div id="document_inner_wrapper">
      <div id="document">
        <p>No document loaded... You can either create a <em>New Document</em> or <em>Browse</em> existing ones.</p>
      </div>
      <div id="attributes"></div>
    </div>
  </script>
  
  <script type="text/x-handlebars-template" name="browser_not_supported">
    <div class="browser-not-supported">
      <h1>Substance
        <p>Open Documents For The Web</p>
      </h1>
      <div></div>
      <div class="lpl texteditor">
        <h2>Browser not supported</h2>
        <p>
          Substance makes use of the latest browser technology. In order to create, publish<br/> and view documents online,
          you need to upgrade your browser.
        </p>
        
        <p class="recommendation">We recommend one of these:</p>
        <div style="text-align: center;">
          <a href="http://www.google.com/chrome/" title="Google Chrome"><img src="/images/chrome.png"/></a>
          <a href="http://www.apple.com/safari/" title="Apple Safari"><img src="/images/safari.png"/></a>
          <!--<a href="http://www.mozilla.com/en-US/firefox/beta/" title="Firefox 4 Beta"><img src="/images/firefox.png"/></a>-->
        </div>
      </div>
    </div>
  </script>
  
  <script type="text/x-handlebars-template" name="collaborators">
    <h3>Currently active Collaborators</h3>
    <ul>
      {{#status/collaborators}}
        <li>{{.}}</li>
      {{/status/collaborators}}
    </ul>
    <p></p>
    <p>Invite new collaborators by sharing this link:</p>
    <p>
      <input type="text" value="http://{{hostname}}/#{{author}}/{{name}}" style="width: 450px;"></input>
    </p>
  </script>
  
  <script type="text/x-ejs-template" name="browser_tab">
    <div class="cursor"><span></span></div>
    <div class="icon <%= query ? query.type : "keyword" %>"></div>
    <div class="tab-label">Browser</div>
    <form id="search_form"><input type="text" title="Start searching" id="search" name="search" value="<%= query_descr %>" autocomplete="off"/></form>
    <!--<div class="count"><%= documents.length > 0 ? documents.length : ''%></div>-->
    <br class="clear"/>
    
    <div class="options">
      <% if ((!query && app.username) || (query && query.type !== 'user' && app.username)) { %> <a href="/<%= app.username %>" class="toggle-userdocs" title="My Documents"><div class="icon user"></div></a><% } %>
      <% if ((!query && app.username) || (query && query.type !== 'subscribed' && app.username)) { %> <a href="/subscribed" class="toggle-subscribed" title="Subscribed Documents"><div class="icon subscribed"></div></a><% } %>
      <% if (!query || query.type !== 'recent') { %> <a href="/recent" class="toggle-recent" title="Recent Documents"><div class="icon recent"></div></a><% } %>
    </div>
    <div class="results"></div>
  </script>
  
  <script type="text/x-ejs-template" name="document_tab">
    <div class="cursor"><span></span></div>
    <div class="icon read"></div>
    <div class="tab-label">Document</div>
    <div class="user-name">
      <span><%= username %> / </span><input type="text" id="document_name" name="document_name" value="<%= document_name %>" <%= app.document.mode !== 'edit' ? 'disabled="disabled"' : ''%>/>
    </div>
  </script>
  
  <script type="text/x-ejs-template" name="document_browser">
    <div id="browser_actions" class="view-actions">
    </div>
  
    <div id="browser_inner_wrapper">
      
      <div id="card_file">
        <% if (user) { %>
          <div class="container">
            <div class="avatar">
              <img<% if (user.get('username') === app.username) { %> title="Change your avatar at Gravatar.com"<% } %> class="left" src="/avatar/<%= user._id.split('/')[2] %>/100"/>
            </div>
            <div class="username">
              <h1><%= user.get('name') %></h1>
              <p><em>as</em> <b><%= user.get('username') %></b> <em>since</em> <%= _.date(user.get('created_at')) %></p>
              
              <div class="attributes">
                <% if (user.get('location')) { %>
                  <div><em>Located in</em> <%= user.get('location') %></div>
                <% } %>

                <% if (user.get('company')) { %>
                  <div><em>Works at</em> <%= user.get('company') %></div>
                <% } %>

                <% if (user.get('website')) { %>
                  <div><em>Website at</em> <a target="_blank" href="<%= user.get('website') %>"><%= user.get('website') %></a></div>
                <% } %>
              </div>
            </div>
          </div>
        <% } else { %>
          <% if (query.type == "recent") { %>
            <h1>Recent Documents</h1>
          <% } else if (query.type === "subscribed") { %>
            <h1>Subscribed Documents</h1>
          <% } else { %>
            <h1>Documents matching &quot;<%= query.value %>&quot;</h1>
          <% } %>
        <% } %>
        
        <h2><%= documents.length %> Document<%= documents.length !== 1 ? 's' : '' %></h2>
      </div>
    
      <% if (documents.length > 0) { %>
        <div id="browser">
          <div id="facets">
            Loading facets...
          </div>
          
          <div id="documents">
            <% documents.each(function(doc) { %> 
            <div class="document">
              <div class="icon published"></div>
              <div class="title"><a class="link load-document" href="/<%= doc.get('creator')._id.split('/')[2] %>/<%= doc.get('name') %>" document="<%= doc._id %>" user="<%= doc.get('creator')._id.split('/')[2] %>" name="<%= doc.get('name') %>"><%= doc.get('title') || 'Untitled' %></a></div>
              <div class="author"><%= doc.get('creator').get('name') || doc.get('creator').get('username') || doc.get('creator')._id.split('/')[2] %></div>
              <div class="dates">
                <% if (doc.get('published_on')) { %>
                  <div class="published-on" title="Published on"><%= _.date(doc.get('published_on')) %></div>
                <% } %>
                <div class="updated-at"><span>updated </span><%= _.prettyDate(doc.get('updated_at')) %></div>
              </div>
            </div>
            <% }); %>
          </div>
        </div>
      <% } else { %>
        <div id="browser">
          <div id="documents">
            <h2>No Documents yet ...</h2>
          </div>
        </div>
      <% } %>
    </div>
  </script>
  
  <script type="text/x-handlebars-template" name="facets">
    <div class="list">
      {{^facets}}
        <p class="no-filters">No filters available</p>
      {{/facets}}
      
      {{#facets}}
        <div class="facet" id="facet_{{property}}">
          <h3>{{property_name}}</h3>
          <ul class="facet-choices">
            {{#selected_facet_choices}}
              <li class="facet-choice selected"><a href="/" class="remove-criterion" property="{{../property}}" operator="CONTAINS" value="{{key}}">{{value}}<span class="item-count">{{item_count}}</span></a></li>
            {{/selected_facet_choices}}
            {{#facet_choices}}
              <li class="facet-choice"><a href="/" class="add-criterion" property="{{../property}}" operator="CONTAINS" value="{{key}}">{{value}}<span class="item-count">{{item_count}}</span></a></li>
            {{/facet_choices}}
          </ul>
        </div>
      {{/facets}}
    </div>
  </script>
  
  <script type="text/x-handlebars-template" name="controls">
    <div class="controls" node="<%= node._id %>" destination="<%= destination %>">
      <div class="handle">
        <a href="/">--&gt; INSERT</a>
      </div>
      <div class="actions">
        <div class="placeholder insert">Insert Content</div>
        <div class="placeholder move">Move</div>
        <% actions.each(function(action) { %>
            <% if (action.length === 0) return; %>
            <% if (action.length === 1) { %>
              <% _.each(action, function(v) { %>
                <span>
                <a href="/" type="<%= v.nodeType %>" destination="<%= destination %>" node="<%= v.node %>" parent="<%= v.parentNode %>" class="add add_<%= v.insertionType %>"><%= v.nodeTypeName %></a>
                </span>
              <% }); %>
            <% } else { %>
              <span class="container add">
              <%= action[0].nodeTypeName %>
              <div>
                <% _.each(action, function(v) { %>
                  <a href="/" type="<%= v.nodeType %>" destination="<%= destination %>" node="<%= v.node %>" parent="<%= v.parentNode %>" class="add add_<%= v.insertionType %>">Level <%= v.level %></a>
                <% }); %>
              </div>
              </span>
            <% } %>
        <% }); %>
        
        <div class="move-targets">
          <!-- container node targets  -->
          <% _.each(path, function(n, index) { %>
            <span><a class="move-node container-node" href="/" node="<%= n._id %>" destination="<%= destination %>" level="<%= (index+1) %>"><!--<%= destination %>--> Here <!--&quot;<%= ContentNode.getTeaser(n).trim() %>&quot;--> at level <%= n.level %></a></span>
          <% }); %>
          
          <!-- allow child insertion for empty container nodes -->
          <% if (insertion_type === 'child' && node.level < 3) { %>
            <span><a class="move-node container-node <%= insertion_type %>" href="/" node="<%= node._id %>" destination="<%= destination %>"><!--Inside--> Here <!--&quot;<%= ContentNode.getTeaser(node).trim() %>&quot;--> at level <%= (node.level+1) %></a></span>
          <% } %>
          
          <!-- leaf node target  -->
          <span><a class="move-node leaf-node <%= insertion_type %>" href="/" node="<%= node._id %>" destination="<%= destination %>"><!--<%= insertion_type == "sibling" ? destination : "inside" %>--> Here <!--&quot;<%= ContentNode.getTeaser(node).trim() %>&quot;--></a></span>
        </div>
        
        <span class="message">
          
        </span>
        <br class="clear"/>
      </div>
    </div>
  </script>
  
  <script type="text/x-handlebars-template" name="edit_text">
    <h3>Edit Text</h3>
    <div class="lpl texteditor" id="edit_node">
    </div>
  </script>
  
  <script type="text/x-handlebars-template" name="edit_section">
    <h3>Edit section</h3>
  </script>
  
  <script type="text/x-ejs-template" name="comments">    
    <div class="comments-title" id="comments<%= node.html_id %>">Comments</div>
    <div class="comments">
      <% if (comments) { %>
        <% comments.each(function(comment, key) { %>
          <div class="comment" id="<%= comment.html_id %>">
            <% username = comment.get('creator')._id.split('/')[2]; %>
            <div class="header">
              <a href="/<%= username%>"><%= username %></a>
              commented <%= _.prettyDate(comment.get('created_at')) %>
              <% if (app.username === username) { %>
                <a href="/" comment="<%= comment._id %>" class="remove-comment">Remove</a></div>
              <% } %>
            <div class="body">
              <% var version = comment.get('version') ? comment.get('version')._id.split('/')[3] : null; %>
              
              <!--Version: <%= version %> / <%= app.document.version %>-->
              
              <% if (version !== app.document.version || !(!!version === !!app.document.version)) { %>
                <div class="different-version" title="This comment belongs to a different document version.">
                  <a href="/<%= username %>/<%= doc.get('name') %><%= version ? "/"+version : "" %>/<%= node.html_id %>/<%= comment.html_id %>">different version</a>
                </div>
              <% } %>
              <%= comment.get('content') %>
            </div>
          </div>
        <% }); %>
      <% } %>
    </div>
    <% if (app.username) { %>
      <div class="add-comment">
        <a href="/" class="create-comment">Add Comment</a>
        <div class="comment-content empty"><p>&laquo; Enter Comment &raquo;</p></div>
      </div>
    <% } else { %>
      To comment on content fragments you need to be logged in.
    <% } %>
    
  </script>
  
  <script type="text/x-ejs/template" name="recover_password">
    
    <div id="recover_password">
        <div class="title">Substance</div>

        <div class="recover page-content">
          <form id="recover-form">
            <h1>Reset Password</h1>
            <div>
              Substance will send password reset instructions to the email address associated with your account.
            </div>
            <div id="registration_error_message"></div>
            <div>
              <label for="username">Enter Username:<span></span></label>
              <input type="text" id="username" class="username" name="name"/>
            </div>
            
            <div>
              <label for="">&nbsp;</label>
              <input type="submit" value="Send Instructions"/>
            </div>
          </form>
        </div>
        <div class="success page-content">
          <h1>Reset instructions have been sent via email.</h1>
        </div>
    </div>
  </script>
  
  <script type="text/x-ejs/template" name="reset_password">
    <div id="reset_password">
        <div class="title">Substance</div>
        
        <div class="reset page-content">
          <form id="reset-form">
            <h1>Choose a new password</h1>
            <div id="registration_error_message"></div>
            <div>
              <label for="password">Password:<span></span></label>
              <input type="password" id="password" class="password" name="name"/>
            </div>
            
            <div>
              <label for="password">Confirm Password:<span></span></label>
              <input type="password" id="password_confirmation" class="password" name="password"/>
            </div>
            
            <div>
              <label for="">&nbsp;</label>
              <input type="submit" value="Save"/>
            </div>
          </form>
        </div>
    </div>
  </script>
  
  <script type="text/x-ejs/template" name="confirm_collaboration">
    <div id="confirm_collaboration">
        <div class="title">Substance</div>
      <% if (!collaborator || collaborator.get('user')) { %>
        <div class="summary">
          <h2>Sorry. This Invitation has already been confirmed or was deleted by the author.</h2>
        </div>
      <% } else { %>
        <div class="summary">
          <h2><b><%= document.get('creator')._id.split('/')[2] %></b> would like you to collaborate on his document</h2>
          <div class="document">
            <h1><%= document.get('title') %></h1>
            <p class="lead">
              <%= document.get('lead') %>
            </p>
          </div>
        </div>
        
        <div class="option-tabs">
          <% if (app.username) { %> <a href="#" class="option-tab current active" option="current">Confirm</a> <% } %>
          <a href="#" class="option-tab login<%= !app.username ? " active" : "" %>" option="login">Login</a>
          <a href="#" class="option-tab signup" option="signup">Register</a>
        </div>

        <% if (app.username) { %>
          <div class="option current page-content active">
            
            <form id="confirm-form">
              <h1>Use the current user "<%= app.username %>" to collaborate.</h1>
              <p class="info">Once you confirmed this invitation, you can easily lookup the document in your <b>Subscribed Documents</b> bin.</p>
              <div>
                <input type="submit" value="Confirm"/>
              </div>
            </form>
            
          </div>
        <% } %>
        <div class="option login page-content<%= !app.username ? " active" : "" %>">
          <form id="login-form">
            <h1>Login with your account</h1>
            <p class="info">Once you confirmed this invitation, you can easily lookup the document in your <b>Subscribed Documents</b> bin.</p>
            <div>
              <label for="username">Username:<span></span></label>
              <input type="text" id="username" class="username" name="name"/>
            </div>
            
            <div>
              <label for="password">Password:<span><a href="/recover">Forgot Password?</a></span></label>
              <input type="password" id="password" class="password" name="password"/>
            </div>
            
            <div>
              <label for="">&nbsp;</label>
              <input type="submit" value="Login"/>
            </div>
          </form>
        </div>
        
        <div class="option signup page-content">
          <form id="signup-form" class="auth-form">
            <h1>Create a new account</h1>
            <p class="info">Once you confirmed this invitation, you can easily lookup the document in your <b>Subscribed Documents</b> bin.</p>
            <div id="registration_error_message"></div>
            
            <div>
              <label for="signup_user">Username:<span>http://substance.io/#USERNAME</span></label>
              <input type="text" id="signup_user" name="username"/>
              <div class="input-message" id="signup_user_message"></div>
            </div>

            <div>
              <label for="signup_name">Full Name:<span>Your real name</span></label>
              <input type="text" id="signup_name" name="name"/>
            </div>

            <div>
              <label for="signup_email">Email:<span>A valid email address</span></label>
              <input type="text" id="signup_email" name="email"/>
            </div>

            <div>
              <label for="signup_password">Password:<span>At least 3 characters</span></label>
              <input type="password" id="signup_password" name="password"/>
            </div>
          
            <div>
              <label for="">&nbsp;</label>
              <input type="submit" value="Create Account"/>
              
            </div>
            
          </form>
          
        </div>
      <% } %>
    </div>
  </script>
  
  
  <script type="text/x-ejs/template" name="publish_settings">
    <div class="settings-title">Publish</div>
    
    <% if (versions.length === 0) { %>
      <p>Not published yet</p>
    <% } %>
    
    <% if (document.get('creator')._id === '/user/'+app.username) { %>
      <div id="new_version">
        <div><input type="text" id="version_remark" name="remark" value="Enter optional remark."/></div>
        <div class="panel">
          <a href="#" class="publish-document">Publish new version</a>
        </div>
      </div>
    <% } %>
    
    <% if (versions.length > 0) { %>
      <h6>Published Versions</h6>
      <div class="versions">
      
        <% versions.each(function(version) { %>
          <a title="<%= version.get('remark') %>"class="version" href="/<%= document.get('creator')._id.split('/')[2] %>/<%= document.get('name') %>/<%= version._id.split('/')[3] %>">
            <div class="label"><%= _.date(version.get('created_at')) %></div>
            <div class="remove-version" version="<%= version._id %>"></div>
          </a>
        <% }); %>
      </div>
    <% } %>
    
  </script>
  
  <script type="text/x-ejs/template" name="document_settings">
  
    <div class="settings-title">Collaborators</div>
    <table class="collaborators">
      <% collaborators.each(function(collaborator) { %>
        <tr class="collaborator">
          <td><%= collaborator.get('email') %></td>
          <td><%= collaborator.get('user') ? "<strong>"+collaborator.get('user')._id.split('/')[2]+"</strong>" : "" %></td>
          
          <td><%= collaborator.get('user') ? '<span class="confirmed">Confirmed</span>' : '<span class="invited">Invited</span>' %></td>
          <% if (document.get('creator')._id === '/user/'+app.username) { %>
          <td class="right-align">
            <select class="change-mode" collaborator="<%= collaborator._id %>">
              <option value="edit">Can edit</option>
              <option value="view"<%= collaborator.get('mode') === "view" ? ' selected="selected"' : "" %>>Can view</option>
            </select>
          </td>
          <td class="right-align">
            <a href="#" class="remove-collaborator" collaborator="<%= collaborator._id %>"><span>x</span></a>
          </td>
          <% } %>
        </tr>
      <% }); %>
    </table>
    <% if (document.get('creator')._id === '/user/'+app.username) { %>
      <h6>Invite Collaborator</h6>
      <form>
        <label>Enter Email Address</label><br/>
        <input type="text" id="collaborator_email" name="collaborator_email"/>
        <select name="mode" id="collaborator_mode">
          <option value="edit">Can edit</option>
          <option value="view">Can view</option>
        </select>
        <input type="submit" value="Invite"/>
      </form>
    <% } %>
  </script>
  
  <!-- content-node templates for the editor -->
  <script type="text/x-ejs-template" name="document">
    
    <div id="toc_wrapper">
      <div class="toc-header">Table Of Contents</div>
      <div id="toc">
        <%= toc %>
      </div>
      <div style="document-separator">&nbsp;</div>
    </div>
    
    <div class="board">
      <div class="toggle-toc"><div class="label">Contents</div></div>
      
      <div id="document_actions" class="view-actions">
        <a href="/" title="Read Document" class="toggle-show-mode view-action-icon read<%= edit ? '' : ' active' %>"><span>Read</span></a>

        <% if (node && node.get('creator')._id === '/user/'+app.username) { %>
          <a href="/" title="Write Document" class="toggle-edit-mode view-action-icon write<%= edit ? ' active' : '' %>"><span>Write</span></a>
          <a href="/" title="Delete Document" class="delete-document view-action-icon delete"><span>Delete</span></a>
        <% } %>
        
        <a href="/" title="<%= node.get('subscribed') ? "Unsubscribe" : "Subscribe document and get notified about updates" %> " class="view-action-icon <%= node.get('subscribed') ? "unsubscribe-document" : "subscribe-document" %>"><div class="subscription-count"><%= node.get('subscribers') > 0 ? node.get('subscribers') : "" %></div><span>Subscribe document and get notified about updates</span></a>
        
        <% if (app.document.authorized) { %>
          <a href="#" class="toggle-settings view-action-icon settings" title="Collaborators"><span>Collaborators</span></a>
          <a href="#" class="toggle-publish-settings view-action-icon publish-settings<%= app.document.published ? " pub" : "" %>" title="Publish"><span>Publish Settings</span></a>
        <% } %>
        
        <a href="#" class="export-document view-action-icon export" title="Export Document (Experimental)"><span>Export</span></a>
      </div>
      
      <div id="document_settings">
        
      </div>
      
      <div id="publish_settings">
        
      </div>
      
      <div id="document_export">
        <h7>Export Document</h7>
        <div class="formats">
          <a href="<%= document.location.href %>.pdf" target="_blank" class="format pdf" title="Adobe PDF"><div class="label">PDF</div></a>
          <a href="<%= document.location.href %>.odt" target="_blank" class="format odf" title="OpenDocument Text"><div class="label">ODT</div></a>
          <a href="<%= document.location.href %>.rtf" target="_blank" class="format rtf" title="Rich Text Format"><div class="label">RTF</div></a>
          <a href="<%= document.location.href %>.epub" target="_blank" class="format epub" title="Electronic Publication"><div class="label">EPUB</div></a>
          <a href="<%= document.location.href %>.shower" target="_blank" class="format shower" title="Shower Slideshow"><div class="label">SHWR</div></a>
        </div>
        <h7>Additional Formats</h7>
        <div class="additional-formats">
          <a href="<%= document.location.href %>.html" target="_blank" class="format html" title="HTML"><div class="label">HTML</div></a>
          <a href="<%= document.location.href %>.latex" target="_blank" class="format latex"><div class="label">LaTeX</div></a>
          <a href="<%= document.location.href %>.markdown" target="_blank" class="format markdown"><div class="label">Markdown</div></a>
          <a href="<%= document.location.href %>.textile" target="_blank" class="format textile"><div class="label">Textile</div></a>
          <a href="<%= document.location.href %>.mediawiki" target="_blank" class="format mediawiki"><div class="label">MediaWiki</div></a>
          <a href="<%= document.location.href %>.texinfo" target="_blank" class="format texinfo"><div class="label">Texinfo</div></a>
          <a href="<%= document.location.href %>.org" target="_blank" class="format org"><div class="label">Emacs Org-Mode</div></a>
          <a href="<%= document.location.href %>.rst" target="_blank" class="format rst"><div class="label">ReStructuredText</div></a>
        </div>
      </div>
    </div>
    <div id="<%= node.html_id %>" name=<%= node.key %> level="<%= level %>" class="content-node document level-<%= level %><%= edit ? " edit" : "" %>">
      <% if (edit) { %><div class="content-node-outline"><div class="cursor"><span></span></div></div><% } %>
      
      <div class="operations">
      </div>
      
      <div class="document-title content<%= empty_title ? ' empty' : '' %>"<% if (edit) { %> contenteditable="true" title="Click To Edit Document Title"<% } %>>
        <% if (!empty_title) { %>
          <%= title %>
        <% } else { %>
          &laquo; Enter Title &raquo;
        <% } %>
      </div>
      <p class="author"><%= node.get('creator').get('name') || node.get('creator').get('username') %></p>
      <p class="published">
        <% if (node.get('published_on')) { %>
          <%= _.date(node.get('published_on')) %>
        <% } %>
      </p>
      <p class="lead content<%= empty_lead ? ' empty' : '' %>" id="document_lead"<% if (edit) { %> contenteditable="true" title="Click To Edit Document Lead"<% } %>>
        <% if (!empty_lead) { %>
          <%= lead %>
        <% } else { %>
          &laquo; Enter Lead &raquo;
        <% } %>
      </p>
      <div class="document-separator"></div>
      <%= content %>
    </div>

  </script>
  
  <script type="text/x-handlebars-template" name="section">
    <div id="{{node/html_id}}" name={{node/key}} parent="{{parent/_id}}" level="{{level}}" draggable="false" class="content-node section level-{{level}}">
      <div class="content-node-outline"><div class="cursor"><span></span></div></div>
      
      <div class="operations">
        <a href="/" class="toggle-comments sticky" title="Toggle comments for Section"><span>{{comments}}</span></a>
        {{#edit}}
        <a href="/" class="remove-node" title="Remove Node" node="{{node/key}}" parent="{{parent/_id}}"></a>
        <a href="/" class="toggle-move-node" title="Move Section â€” Use placeholders as targets"></a>
        {{/edit}}
      </div>
      
      {{#edit}}<div class="pilcrow">&#182;</div>{{/edit}}
      
      <h{{heading_level}} class="content{{#empty}} empty{{/empty}}"{{#edit}} title="Click To Edit Section Name"{{/edit}}>
        {{^empty}}{{{name}}}{{/empty}}
        {{#empty}}&laquo; Enter Section Name &raquo;{{/empty}}
      </h{{heading_level}}>
      
      {{#edit}}<div class="node-editor-placeholder"></div>{{/edit}}
      {{{content}}}
      <div class="comments-wrapper{{^edit}} expanded{{/edit}}"></div>
    </div>
  </script>
  
  <script type="text/x-handlebars-template" name="text">
    <div id="<%= node.html_id %>" name=<%= node.key %> parent="<%= parent._id %>" level="<%= level %>" draggable="false" class="content-node text level-<%= level %>">
      <div class="content-node-outline"><div class="cursor"><span></span></div></div>
      
      <div class="operations">
        <a href="/" class="toggle-comments sticky" title="Toggle comments for Text"><span><%= comments %></span></a>
        <% if (edit) { %>
          <a href="/" class="remove-node" title="Remove Node" node="<%= node.key %>" parent="<%= parent._id %>"></a>
          <a href="/" class="toggle-move-node" title="Move Text â€” Use placeholders as targets"></a>
        <% } %>
      </div>
      
      <% if (edit) { %><div class="pilcrow">&#182;</div> <% } %>
      
      <div class="content<%= empty ? " empty" : "" %>"<%= empty ? 'title="Click To Edit Text"' : "" %>>
        <%= empty ? "<p>&laquo; Enter Text &raquo;</p>" : content %>
      </div>
      <% if (edit) { %><div class="node-editor-placeholder"></div><% } %>
      <div class="comments-wrapper <%= !edit ? "expanded" : ""%>"></div>
    </div>
  </script>
  
  <script type="text/x-handlebars-template" name="quote">
    <div id="{{node/html_id}}" name={{node/key}} parent="{{parent/_id}}" level="{{level}}" draggable="false" class="content-node quote level-{{level}}">
      <div class="content-node-outline"><div class="cursor"><span></span></div></div>
        <div class="operations">
          <a href="/" class="toggle-comments sticky" title="Toggle comments for Quote"><span>{{comments}}</span></a>
          {{#edit}}
            <a href="/" class="remove-node" title="Remove Node" node="{{node/key}}" parent="{{parent/_id}}"></a>
            <a href="/" class="toggle-move-node" title="Move Quote â€” Use placeholders as targets"></a>
          {{/edit}}
        </div>
      
      {{#edit}}<div class="pilcrow">&#182;</div>{{/edit}}
      <blockquote>
        <p class="content quote-content{{#empty_content}} empty{{/empty_content}}"{{#edit}} contenteditable="true" title="Click To Edit Quote"{{/edit}}>
          {{^empty_content}}{{{content}}}{{/empty_content}}
          {{#empty_content}}&laquo; Enter Quote &raquo;{{/empty_content}}
        </p>
        <br clear="both"/>
        <cite class="content quote-author{{#empty_author}} empty{{/empty_author}}"{{#edit}} contenteditable="true" title="Click To Edit Quote Author"{{/edit}}>
          {{^empty_author}}{{{author}}}{{/empty_author}}
          {{#empty_author}}&laquo; Enter Author &raquo;{{/empty_author}}
        </cite>
      </blockquote>
      <br class="clear"/>
      {{#edit}}<div class="node-editor-placeholder"></div>{{/edit}}
      <div class="comments-wrapper{{^edit}} expanded{{/edit}}"></div>
    </div>
  </script>
  
  <script type="text/x-handlebars-template" name="code">
    <div id="{{node/html_id}}" name={{node/key}} parent="{{parent/_id}}" level="{{level}}" draggable="false" class="content-node code level-{{level}}">
      <div class="content-node-outline"><div class="cursor"><span></span></div></div>
        <div class="operations">
          <a href="/" class="toggle-comments sticky" title="Toggle comments for Code"><span>{{comments}}</span></a>
          {{#edit}}
            <a href="/" class="remove-node" title="Remove Node" node="{{node/key}}" parent="{{parent/_id}}"></a>
            <a href="/" class="toggle-move-node" title="Move Code â€” Use placeholders as targets"></a>
          {{/edit}}
        </div>
      
      {{#edit}}<div class="pilcrow">&#182;</div>{{/edit}}
      <textarea class="content"{{#edit}} title="Click To Edit Code"{{/edit}}>{{{content}}}</textarea>
      {{#edit}}<div class="node-editor-placeholder"></div>{{/edit}}
      <div class="comments-wrapper{{^edit}} expanded{{/edit}}"></div>
    </div>
  </script>
  
  <script type="text/x-handlebars-template" name="gist">
    <div id="{{node/html_id}}" name={{node/key}} parent="{{parent/_id}}" level="{{level}}" draggable="false" class="content-node gist level-{{level}}">
      <div class="content-node-outline"><div class="cursor"><span></span></div></div>
        <div class="operations">
          <a href="/" class="toggle-comments sticky" title="Toggle comments for Gist"><span>{{comments}}</span></a>
          {{#edit}}
            <a href="/" class="remove-node" title="Remove Node" node="{{node/key}}" parent="{{parent/_id}}"></a>
            <a href="/" class="toggle-move-node" title="Move Gist â€” Use placeholders as targets"></a>
          {{/edit}}
        </div>
      
      {{#edit}}<div class="pilcrow">&#182;</div>{{/edit}}
      
      <style>
        .gist.selected { padding-bottom: 9px; }
        .gist .row { clear: both; overflow: hidden; }
      
        .gist .edit-in-c9 { display: none }
        .gist .tabular-input {
            padding-top: 27px;
            margin-bottom: 14px; /* its actually 14, but the text editor already takes 10 */
        }
        
        .gist .clone-url {
            font-family: 'Palatino Linotype', 'Book Antiqua', Palatino, FreeSerif, serif;
            font-size: 16px;
            font-style: italic;
            color: #303030;
            display: block;
            margin-bottom: 13px;
        }
        
        .gist .url-container, .gist .file-container {
            float: left;
        }
        
        .gist input[type=text] {
            border: none;
            box-shadow: none;
            background: #E1E1E1;
            border-radius: 0px;
            color: black;
        }
        
        .gist .url-container .url {
            width: 545px;
        }
        
        .gist .file-container {
            margin-left: 12px;
        }
        .gist .file-container label {
            float: left;
            margin-top: 4px;
            font-family: 'Palatino Linotype', 'Book Antiqua', Palatino, FreeSerif, serif;;
            font-size: 14px;
            color: #000;
        }
        .gist .file-container select.file {
            float: left;
        }
        
        .gist .row.lines {
            margin-top: 11px;
        }
        .gist .lines label {
            margin-top: 4px;
            font-family: 'Palatino Linotype', 'Book Antiqua', Palatino, FreeSerif, serif;;
            font-size: 14px;
            color: black;
            margin-right: 7px;
        }
        .gist .lines input[type=text] {
            width: 79px;
            margin-right: 9px;
        }
        .gist .lines * {
            float: left;
            display: block;
        }
        
        .gist .select-file {
            height: 24px;
            width: 114px;
            background: #666;
            font-family: Arial;
            font-size: 12px;
            font-weight: bold;
            color: #fff;
            float: left;
            text-align: center;
            padding-top: 2px;
            margin-left: 10px;                   
            margin-top: 1px;
            height: 25px;            
        }
        .gist .select-file img {
            margin-left: 9px;
            text-align: center;
        }
        
        .gist .select-file-ddl {
            display: block;
            background: #e7e8e5;
            font-family: Arial;
            font-size: 12px;
            color: #000;
            padding-left: 25px;
            list-style: none;
            position: absolute;
            min-width: 140px;
            top: 95px;
            right: 102px;            
        }
        .gist .select-file-ddl li.selected {
            color: purple;
        }
      </style>
      
      <div class="edit-in-c9"><a href='#' target='_blank'>Edit in cloud9</a></div>
      <div class="tabular-input">
        <div class="row">
            <label for='url' class="clone-url">Gist public clone URL</label>
        </div>
        <div class="row">
            <div class="url-container">
                <input type='text' value="{{url}}" name="url" class="url" id='url' spellcheck='false' />
            </div>
            <div class="file-container">
                <label for="file" class="file-label">
                    Then:
                </label>
                <div class="select-file">SELECT FILE<img src="/images/icons/white/arrow-ddl-7x4.png"/></div>
                <select class='file' id='file' style='display: none'></select>
            </div>
        </div>
        <div class="row lines">
            <label for='line_start'>Show lines:</label>
            <input type='text' class='line_start' id='line_start' value='{{line_start}}' />
            <label for='line_end'>To:</label>
            <input type='text' class='line_end' id='line_end' value='{{line_end}}' />            
        </div>
      </div>
      
      <textarea class="snippet">{{{snippet}}}</textarea>
      
      {{#edit}}<div class="node-editor-placeholder"></div>{{/edit}}
      <div class="comments-wrapper{{^edit}} expanded{{/edit}}"></div>
    </div>
  </script>
  
  <script type="text/x-handlebars-template" name="question">
    <div id="{{node/html_id}}" name={{node/key}} parent="{{parent/_id}}" level="{{level}}" draggable="false" class="content-node question level-{{level}}">
      <div class="content-node-outline"><div class="cursor"><span></span></div></div>
      
      <div class="operations">
        <a href="/" class="toggle-comments sticky" title="Toggle comments for Question"><span>{{comments}}</span></a>
        {{#edit}}
          <a href="/" class="remove-node" title="Remove Node" node="{{node/key}}" parent="{{parent/_id}}"></a>
          <a href="/" class="toggle-move-node" title="Move Question â€” Use placeholders as targets"></a>
        {{/edit}}
      </div>
      
      {{#edit}}<div class="pilcrow">&#182;</div>{{/edit}}
      <p class="question content{{#empty}} empty{{/empty}}"{{#edit}} title="Click To Edit Question"{{/edit}}>
        {{^empty}}{{{content}}}{{/empty}}
        {{#empty}}&laquo; Enter Question &raquo;{{/empty}}
      </p>
      {{#edit}}<div class="node-editor-placeholder"></div>{{/edit}}
      <div class="comments-wrapper{{^edit}} expanded{{/edit}}"></div>
    </div>
  </script>
  
  <script type="text/x-handlebars-template" name="answer">
    <div id="{{node/html_id}}" name={{node/key}} parent="{{parent/_id}}" level="{{level}}" draggable="false" class="content-node answer level-{{level}}">
      <div class="content-node-outline"{{#edit}} title="Click To Edit Answer"{{/edit}}><div class="cursor"><span></span></div></div>
      
      <div class="operations">
        <a href="/" class="toggle-comments sticky" title="Toggle comments for Answer"><span>{{comments}}</span></a>
        {{#edit}}
          <a href="/" class="remove-node" title="Remove Node" node="{{node/key}}" parent="{{parent/_id}}"></a>
          <a href="/" class="toggle-move-node" title="Move Answer â€” Use placeholders as targets"></a>
        {{/edit}}
      </div>
      
      {{#edit}}<div class="pilcrow">&#182;</div>{{/edit}}
      <div class="answer content{{#empty}} empty{{/empty}}">
        {{^empty}}{{{content}}}{{/empty}}
        {{#empty}}<p>&laquo; Enter Answer &raquo;</p>{{/empty}}
      </div>
      {{#edit}}<div class="node-editor-placeholder"></div>{{/edit}}
      <div class="comments-wrapper{{^edit}} expanded{{/edit}}"></div>
    </div>
  </script>
  
  <script type="text/x-handlebars-template" name="resource">
    <div id="{{node/html_id}}" name={{node/key}} parent="{{parent/_id}}" level="{{level}}" draggable="false" class="content-node resource level-{{level}}">
      <div class="content-node-outline"><div class="cursor"><span></span></div></div>
      
      <div class="operations">
        <a href="/" class="toggle-comments" title="Toggle comments for Resource"></a>
        {{#edit}}
          <a href="/" class="remove-node" title="Remove Node" node="{{node/key}}" parent="{{parent/_id}}"><img src="/images/icons/white/x_alt_16x16.png"/></a>
          <a href="/" class="toggle-move-node" title="Move Resource â€” Use placeholders as targets"><img src="/images/icons/white/arrow_right_16x16.png"/></a>
        {{/edit}}
      </div>
      {{#edit}}<div class="pilcrow">&#182;</div>{{/edit}}
      
      <div class="resource-content{{^url}} placeholder{{/url}}">
        {{#url}}<img src="{{.}}"/>{{/url}}
        {{^url}}<img src="/images/image_placeholder.png"/>{{/url}}
        
        <div class="resource-editor">
          <div class="resource-url-area">
            <div class="url-label">Resource URL (Images are supported yet)</div>
            <div class="url-container">
              <input class="resource-url" type="text" name="url" value="{{url}}"/>
              <div class="status">Enter URL</div>
            </div>
          </div>
        </div>
      </div>
      
      <div class="caption content{{#empty}} empty{{/empty}}">
        {{^empty}}{{{caption}}}{{/empty}}
        {{#empty}}&laquo; Enter Caption &raquo;{{/empty}}
      </div>
      <div class="comments-wrapper{{^edit}} expanded{{/edit}}"></div>
    </div>
  </script>
  
  <script type="text/x-handlebars-template" name="image">
    <div id="<%= node.html_id %>" name=<%= node.key %> parent="<%= parent._id %>" level="<%= level %>" draggable="false" class="content-node image level-<%= level %>">
      
      <div class="content-node-outline"><div class="cursor"><span></span></div></div>
      <div class="operations">
        <a href="/" class="toggle-comments" title="Toggle comments for Image"></a>
        <% if (edit) { %>
          <a href="/" class="remove-node" title="Remove Node" node="<%= node.key %>" parent="<%= parent._id %>"></a>
          <a href="/" class="toggle-move-node" title="Move Image â€” Use placeholders as targets"></a>
        <% } %>
      </div>
      <div class="pilcrow">&#182;</div>
      
      <div class="image-content<%= !url ? " placehoder" : ""%>">
        <% if (url) { %>
          <% if (edit) { %>
            <img src="<%= url %>"/>
          <% } else { %>
            <a href="<%= original_url %>" target="_blank"><img src="<%= url %>"/></a>
          <% } %>
        <% } else { %>
          <img src="/images/image_placeholder.png"/>
        <% } %>
        
        <% if (edit) { %>
          <div class="image-editor">
            <form class="upload-image-form" action="http://api2.transloadit.com/assemblies" enctype="multipart/form-data" method="POST">
              <div class="image-drop-area">
                <div class="info">Drop image here or <a href="/">choose a file</a></div>
                <div class="image-progress">
                  <div class="label">Uploading image ...</div>
                  <div class="progress-container">
                    <div class="progress-bar" style="width:60%"></div>
                  </div>
                </div>
                <div class="credits">Image hosting sponsored by <a href="http://transloadit.com" target="_blank">Transloadit</a></div>
                <input type="file" class="image-file" name="image-file" />
                <input type="hidden" name="params" value="<%= transloadit_params %>" />
              </div>
            </form>
          </div>
        <% } %>
      </div>
      
      <div class="caption content<%= empty ? " empty" : "" %>">
        <%= !empty ? caption : "&laquo; Enter Caption &raquo;" %>
      </div>
      <div class="comments-wrapper <%= !edit ? "expanded" : ""%>"></div>
    </div>
  </script>
  
  <script type="text/x-handlebars-template" name="multi_string_editor">
    <div class="items">
      {{#items}}
        <span class="item">{{.}} <a href="/" value="{{.}}" class="remove-item">x</a></span>
      {{/items}}
      <form>
        <input type="text" name="new_value" autocomplete="off"/>
        <input type="submit" value="Add"/>
        <div class="available-items">
        </div>
      </form>
      <br class="clear"/>
    </div>
  </script>
  
  <script type="text/x-handlebars-template" name="string_editor">
    <input type="text" name="value" value="{{value}}"/>
  </script>
  
  
  <!-- styles --> 
  <link href="/stylesheets/reset.css" media="screen" rel="stylesheet" type="text/css" />
  <link href="/stylesheets/app.css" media="screen" rel="stylesheet" type="text/css" />
  
  <script src="/javascripts/head.min.js"></script>
  <script>
    head.js.apply(this, scripts);
  </script>
  
  {{{{ga}}}}
</head>
<body>
  <div id="container">
    <div id="header">
      
    </div>
    
    <div id="tabs">
      <div id="browser_tab" class="tab" view="browser" title="Browser">
      </div>
      
      <div id="document_tab" class="tab hidden" view="document" title="Document">
      </div>
      
      <a href="/" class="action new-document hidden" title="Create a new document">
        <div class="view-action-icon new"></div>
      </a>
    </div>
    
    <div id="main">
      <!-- Various content (used for user settings dialogue etc.) -->  
      <div id="content_wrapper" class="view">
      </div>
    
      <!-- The document browser -->
      <div id="browser_wrapper" class="view hidden">
      </div>
    
      <!-- The document browser -->
      <div id="document_wrapper" class="view hidden">
      </div>
    </div>
    
    <div id="footer">
      <div class="credits"><a href="http://substance.io/substance/substance">About</a> &middot; <a href="http://twitter.com/_substance" target="_blank">Twitter</a> &middot; <a href="http://github.com/michael/substance" target="_blank">Source Code</a> &middot; <a href="https://groups.google.com/group/substance_" target="_blank">Discuss</a><!-- &middot; <a href="http://github.com/michael/substance/issues" target="_blank">Report Bugs</a>--></div>
      <div class="version"><a href="http://substance.io/substance/release-notes">Substance 0.3.7</a></div>
    </div>
  </div>
  
  <div id="sync_state"></div>
  
  <div id="notifications">
    <div class="wrapper">
    </div>
  </div>
  
  <div class="tooltip">
    
  </div>
</body>
</html>
